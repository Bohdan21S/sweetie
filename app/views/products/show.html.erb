<h1><%= @product.name %></h1>

<% if @product.image.attached? %>
  <%= image_tag @product.image, style: "max-width: 300px;" %>
<% end %>


<p>Description: <%= @product.description %></p>
<p>Price: $<%= @product.price %></p>
<p>Weight: <%= @product.weight %> grams</p>
<p>Category: <%= @product.category.name %></p>

<%= link_to 'Back to Products', products_path %>

<%= form_with url: user_signed_in? ? cart_items_path : new_user_session_path, method: :post do |f| %>
  <% if user_signed_in? %>
    <%= hidden_field_tag :product_id, @product.id %>
    <%= label_tag :quantity, 'Кількість' %>
    <%= hidden_field_tag :quantity, 1 %>
    <%= number_field_tag :quantity, 1, min: 1 %>
  <% end %>
  <%= f.submit 'Додати до корзини' %>
<% end %>

<h2>Залишити відгук</h2>

<% if user_signed_in? %>
  <%= form_with model: [@product, Review.new], local: true do |f| %>
    <div>
      <%= f.label :rating, 'Оцінка (1-10)' %>
      <%= f.number_field :rating, min: 1, max: 10 %>
    </div>

    <div>
      <%= f.label :content, 'Ваш відгук' %>
      <%= f.text_area :content %>
    </div>

    <div>
      <%= f.label :images, 'Додайте фотографії (за бажанням)' %>
      <%= f.file_field :images, multiple: true %>
    </div>

    <div>
      <%= f.submit 'Залишити відгук' %>
    </div>
  <% end %>
<% else %>
  <p>Ви повинні <%= link_to 'увійти', new_user_session_path %>, щоб залишити відгук.</p>
<% end %>

<% if user_signed_in? && current_user.admin? %>
  <h3>Відгуки</h3>
  <% @product.reviews.each do |review| %>
    <div>
      <p><strong><%= review.user.email %>:</strong></p>
      <p>Оцінка: <%= review.rating %>/10</p>
      <p><%= review.content %></p>

      <% if review.images.attached? %>
        <p>Фотографії:</p>
        <% review.images.each do |image| %>
          <%= image_tag image, style: 'max-width: 150px; margin-right: 10px;' %>
        <% end %>
      <% end %>

      <% if review.admin_response.present? %>
        <p><strong>Відповідь адміністратора:</strong> <%= review.admin_response %></p>
      <% else %>
        <%= form_with url: admin_review_path(review), method: :patch, local: true do |f| %>
          <div>
            <%= f.label :admin_response, 'Ваша відповідь' %>
            <%= f.text_area :admin_response %>
          </div>
          <%= f.submit 'Відповісти' %>
        <% end %>
      <% end %>
    </div>
    <hr>
  <% end %>
<% else %>
  <h3>Відгуки</h3>
  <% @product.reviews.each do |review| %>
    <div>
      <p><strong><%= review.user.email %>:</strong></p>
      <p>Оцінка: <%= review.rating %>/10</p>
      <p><%= review.content %></p>

      <% if review.images.attached? %>
        <p>Фотографії:</p>
        <% review.images.each do |image| %>
          <%= image_tag image, style: 'max-width: 150px; margin-right: 10px;' %>
        <% end %>
      <% end %>

      <% if review.admin_response.present? %>
        <p><strong>Відповідь адміністратора:</strong> <%= review.admin_response %></p>
      <% end %>
    </div>
    <hr>
  <% end %>
<% end %>



<%# if user_signed_in? %>
  <%#= form_with url: cart_items_path, method: :post do |f| %>
    <%#= hidden_field_tag :product_id, @product.id %>
    <%#= label_tag :quantity, 'Кількість' %>
    <%#= number_field_tag :quantity, 1, min: 1 %>
    <%#= f.submit 'Додати до корзини' %>
  <%# end %>
<%# else %>
<!--  <p>Увійдіть, щоб додавати товари до корзини.</p>-->
<%# end %>
